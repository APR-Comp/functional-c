#!/bin/bash
script_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
benchmark_name=$(echo $script_dir | rev | cut -d "/" -f 3 | rev)
project_name=$(echo $script_dir | rev | cut -d "/" -f 2 | rev)
bug_id=$(echo $script_dir | rev | cut -d "/" -f 1 | rev)
dir_name=/experiment/$benchmark_name/$project_name/$bug_id
TEST_ID=$1
EXIT_CODE=1

test_cases=("test_yield_from.py" "test_unicode.py" "test_pickletools.py" "test_exceptions.py" "test_tarfile.py" "test_struct.py" "test_shelve.py" "test_context.py" "test_sundry.py" "test_fcntl.py" "test_dictviews.py" "test_multiprocessing_spawn.py" "test_peepholer.py" "test_raise.py" "test_pydoc.py" "test_configparser.py" "test_genericclass.py" "test_logging.py" "test_ossaudiodev.py" "test_cgitb.py" "test_winsound.py" "test_strftime.py" "test_module.py" "test_codecmaps_hk.py" "test_interpreters.py" "test_codecencodings_jp.py" "test_frozen.py" "test_pwd.py" "test_time.py" "test_sched.py" "test_dictcomps.py" "test_float.py" "test_pkg.py" "test_doctest2.py" "test_largefile.py" "test_stringprep.py" "test_urllib2net.py" "test_mmap.py" "test_xxtestfuzz.py" "test_code_module.py" "test_weakref.py" "test_ipaddress.py" "test_cmath.py" "test_atexit.py" "test_glob.py" "test_asyncgen.py" "test_timeout.py" "test_xxlimited.py" "test_global.py" "test_xmlrpc_net.py" "test_ioctl.py" "test_reprlib.py" "test_codecmaps_tw.py" "test_lzma.py" "test_regrtest.py" "test_nntplib.py" "test_netrc.py" "test_wsgiref.py" "test_hashlib.py" "test_string.py" "test_unicode_identifiers.py" "test_univnewlines.py" "test_xdrlib.py" "test_fractions.py" "test_timeit.py" "test_collections.py" "test_marshal.py" "test_fileutils.py" "test_memoryio.py" "test_class.py" "test_getpass.py" "test_bigaddrspace.py" "test_docxmlrpc.py" "test_patma.py" "test_imghdr.py" "test_complex.py" "test_http_cookies.py" "test_operator.py" "test_descr.py" "test_spwd.py" "test_readline.py" "test_uu.py" "test_weakset.py" "test_descrtut.py" "test_ttk_textonly.py" "test_codeccallbacks.py" "test_argparse.py" "test_crypt.py" "test_codecmaps_kr.py" "test_resource.py" "test_imp.py" "test_genericalias.py" "test_defaultdict.py" "test_augassign.py" "test_xmlrpc.py" "test_exception_group.py" "test_multibytecodec.py" "test_with.py" "test_graphlib.py" "test_tcl.py" "test_type_comments.py" "test_bigmem.py" "test_syntax.py" "test_httplib.py" "test_modulefinder.py" "test_ucn.py" "test_signal.py" "test_concurrent_futures.py" "test_embed.py" "test_tokenize.py" "test__locale.py" "test_htmlparser.py" "test_codecencodings_tw.py" "test_iterlen.py" "test_bdb.py" "test_index.py" "test_userlist.py" "test_gettext.py" "test_codecs.py" "test_builtin.py" "test__osx_support.py" "test_bool.py" "test_lltrace.py" "test_int.py" "test_codecmaps_cn.py" "test_wmi.py" "test_csv.py" "test_enumerate.py" "test_threading_local.py" "test_funcattrs.py" "test_audioop.py" "test_imaplib.py" "test_dbm_gnu.py" "test_zipfile64.py" "test_cmd.py" "test_itertools.py" "test_bz2.py" "test_dtrace.py" "test_queue.py" "test_ordered_dict.py" "test_future4.py" "test_opcache.py" "test_calendar.py" "test_bytes.py" "test_coroutines.py" "test_bufio.py" "test_call.py" "test_bisect.py" "test_codecencodings_kr.py" "test_rlcompleter.py" "test_optparse.py" "test_devpoll.py" "test_uuid.py" "test_wait3.py" "test_threading.py" "test_osx_env.py" "test_urllib_response.py" "test_except_star.py" "test_urllib2_localnet.py" "test_socket.py" "test_select.py" "test_fork1.py" "test_exception_hierarchy.py" "test_stat.py" "test_unparse.py" "test_cprofile.py" "test_datetime.py" "test_exception_variations.py" "test_print.py" "test_userstring.py" "test_venv.py" "test_dict.py" "test_locale.py" "test_string_literals.py" "test_support.py" "test_contextlib_async.py" "test_webbrowser.py" "test_startfile.py" "test_smtplib.py" "test_pow.py" "test_dis.py" "test_re.py" "test_charmapcodec.py" "test_sax.py" "test_decimal.py" "test_keywordonlyarg.py" "test_unpack_ex.py" "test_mimetypes.py" "test_idle.py" "test_pkgutil.py" "test_sort.py" "test_httpservers.py" "test_xml_etree.py" "test_stable_abi_ctypes.py" "test_extcall.py" "test_subprocess.py" "test_generator_stop.py" "test_genexps.py" "test_crashers.py" "test_openpty.py" "test_sunau.py" "test_unpack.py" "test_scope.py" "test_winconsoleio.py" "test_selectors.py" "test_fnmatch.py" "test_secrets.py" "test_dbm_ndbm.py" "test_unicodedata.py" "test_longexp.py" "test_cmd_line.py" "test_sndhdr.py" "test_dbm_dumb.py" "test_multiprocessing_forkserver.py" "test_codecencodings_hk.py" "test_tabnanny.py" "test_unicode_file_functions.py" "test_contextlib.py" "test_symtable.py" "test_posixpath.py" "test_profile.py" "test_set.py" "test_cgi.py" "test_slice.py" "test_nis.py" "test_perf_profiler.py" "test_abc.py" "test_types.py" "test_richcmp.py" "test_typing.py" "test_heapq.py" "test_structseq.py" "test_utf8source.py" "test_genericpath.py" "test_gc.py" "test_sysconfig.py" "test_future3.py" "test_quopri.py" "test_type_annotations.py" "test_traceback.py" "test_code.py" "test_property.py" "test_urllibnet.py" "test_pathlib.py" "test_statistics.py" "test_aifc.py" "test_getpath.py" "test_site.py" "test_eintr.py" "test_unary.py" "test_fileinput.py" "test_pyclbr.py" "test_check_c_globals.py" "test_tix.py" "test_errno.py" "test_ntpath.py" "test_dataclasses.py" "test_pstats.py" "test_binop.py" "test_strtod.py" "test_xml_dom_minicompat.py" "test__opcode.py" "test_difflib.py" "test_colorsys.py" "test_asdl_parser.py" "test___future__.py" "test_smtpnet.py" "test_listcomps.py" "test_telnetlib.py" "test_pprint.py" "test_fstring.py" "test_msilib.py" "test_long.py" "test_posix.py" "test_http_cookiejar.py" "test_syslog.py" "test_list.py" "test_file_eintr.py" "test_copyreg.py" "test_ssl.py" "test_threadedtempfile.py" "test_popen.py" "test__xxsubinterpreters.py" "test_pickle.py" "test_sys.py" "test_source_encoding.py" "test_codeop.py" "test_functools.py" "test_sys_settrace.py" "test_grammar.py" "test_doctest.py" "test_baseexception.py" "test_textwrap.py" "test_pyexpat.py" "test_unicode_file.py" "test_math.py" "test_copy.py" "test_compare.py" "test_codecencodings_iso2022.py" "test_setcomps.py" "test_compileall.py" "test_faulthandler.py" "test_isinstance.py" "test_generators.py" "test_robotparser.py" "test_numeric_tower.py" "test_pty.py" "test_grp.py" "test_turtle.py" "test_multiprocessing_fork.py" "test_flufl.py" "test_named_expressions.py" "test_finalization.py" "test_tracemalloc.py" "test_script_helper.py" "test_hash.py" "test_urllib2.py" "test_subclassinit.py" "test_utf8_mode.py" "test_positional_only_arg.py" "test_file.py" "test_binascii.py" "test_kqueue.py" "test_abstract_numbers.py" "test_buffer.py" "test_pulldom.py" "test_wave.py" "test_audit.py" "test_tempfile.py" "test_base64.py" "test_decorators.py" "test_future5.py" "test_cmd_line_script.py" "test_type_cache.py" "test_filecmp.py" "test_metaclass.py" "test_launcher.py" "test_multiprocessing_main_handling.py" "test_repl.py" "test_minidom.py" "test_future.py" "test_hmac.py" "test_mailbox.py" "test_iter.py" "test_super.py" "test_array.py" "test_html.py" "test_userdict.py" "test_cppext.py" "test_clinic.py" "test_gzip.py" "test_zipapp.py" "test_runpy.py" "test_typechecks.py" "test_memoryview.py" "test_threadsignals.py" "test_py_compile.py" "test_pdb.py" "test_plistlib.py" "test_os.py" "test_inspect.py" "test_fileio.py" "test_socketserver.py" "test_dynamicclassattribute.py" "test_codecencodings_cn.py" "test_thread.py" "test_range.py" "test_dict_version.py" "test_winreg.py" "test_curses.py" "test_urlparse.py" "test_shutil.py" "test_mailcap.py" "test_contains.py" "test_xml_etree_c.py" "test_c_locale_coercion.py" "test_pipes.py" "test_zipimport_support.py" "test_compiler_codegen.py" "test_picklebuffer.py" "test_eof.py" "test_sys_setprofile.py" "test_pep646_syntax.py" "test_io.py" "test_frame.py" "test_random.py" "test_opcodes.py" "test_trace.py" "test_linecache.py" "test_wait4.py" "test_ensurepip.py" "test_format.py" "test_compile.py" "test_epoll.py" "test_deque.py" "test_urllib.py" "test_poplib.py" "test_poll.py" "test_int_literal.py" "test_dbm.py" "test_zlib.py" "test___all__.py" "test_getopt.py" "test_zipimport.py" "test_shlex.py" "test_tuple.py" "test_strptime.py" "test_platform.py" "test_ast.py" "test_enum.py" "test_keyword.py" "test_ftplib.py" "test_dynamic.py" "test_codecmaps_jp.py" "test_gdb.py")
total_test=${#test_cases[@]}

if [ -z "$TEST_ID" ];
then
  echo "requires a test case id"
  exit 255
fi


if [ "$TEST_ID" -ge "$total_test" ];
then
  echo "invalid test id"
  exit 255
fi

test_case=${test_cases[$TEST_ID-1]}
cd $dir_name/src
timeout 10 ./python -m test $test_case > /dev/null 2>&1;


EXIT_CODE=$?

if [[ EXIT_CODE -eq 0 ]]
then
  echo "PASS"
else
  echo "FAIL"
fi;

exit $EXIT_CODE